<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIP-BOY 3000 Mk.IV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #22c55e;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            height: 90vh;
            position: relative;
        }

        /* CRT overlay */
        .crt-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 10;
            opacity: 0.1;
            background: repeating-linear-gradient(
                0deg,
                rgba(0,0,0,0.15) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0,0,0,0.15) 3px
            );
        }

        /* Main terminal */
        .terminal {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #064e3b 0%, #000 100%);
            border: 8px solid #374151;
            border-radius: 8px;
            box-shadow: 0 0 60px rgba(34, 197, 94, 0.3), inset 0 0 40px rgba(0,0,0,0.8);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 30px;
        }

        /* Scanline effect */
        .scanline {
            position: absolute;
            inset: 0;
            pointer-events: none;
            opacity: 0.05;
            background: linear-gradient(transparent 50%, rgba(34, 197, 94, 0.3) 50%);
            background-size: 100% 4px;
            animation: scanline 8s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }

        /* Header */
        .header {
            border: 2px solid #22c55e;
            background: rgba(0,0,0,0.6);
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            z-index: 5;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
        }

        .datetime {
            font-size: 16px;
            letter-spacing: 1px;
        }

        /* Hierarchical Navigation */
        .nav-container {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-top: 1px solid rgba(34, 197, 94, 0.3);
        }

        /* Main tabs (top level) */
        .main-tabs {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: rgba(0,0,0,0.4);
            border: 2px solid #166534;
            color: #22c55e;
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: rgba(34, 197, 94, 0.2);
            border-color: #22c55e;
        }

        .tab-btn.active {
            background: #22c55e;
            color: #000;
            border-color: #22c55e;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
        }

        /* Sub tabs */
        .sub-tabs {
            display: flex;
            gap: 5px;
            padding: 5px 0;
            flex-wrap: wrap;
        }

        .sub-tab {
            background: transparent;
            border: 1px solid #166534;
            color: #16a34a;
            padding: 6px 12px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .sub-tab:hover {
            border-color: #22c55e;
            color: #22c55e;
        }

        .sub-tab.active {
            background: #16a34a;
            color: #000;
            border-color: #16a34a;
        }

        /* Content area */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border: 2px solid #166534;
            position: relative;
        }

        /* Quest-style list (from screenshot) */
        .quest-list {
            list-style: none;
        }

        .quest-item {
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(0,0,0,0.4);
            border-left: 3px solid #22c55e;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quest-item:hover {
            background: rgba(34, 197, 94, 0.1);
            border-left-width: 5px;
        }

        .quest-item.active {
            background: rgba(34, 197, 94, 0.2);
            border-left-color: #00ff41;
        }

        .quest-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .quest-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .quest-objective {
            font-size: 13px;
            color: #16a34a;
            padding-left: 15px;
            margin: 5px 0;
        }

        .quest-objective::before {
            content: "✓ ";
            margin-right: 5px;
        }

        .quest-objective.incomplete::before {
            content: "○ ";
        }

        /* Memo style (from screenshot) */
        .memo-container {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border: 2px solid #166534;
        }

        .memo-textarea {
            width: 100%;
            min-height: 400px;
            background: rgba(0,0,0,0.6);
            border: 2px solid #22c55e;
            color: #22c55e;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
        }

        .memo-textarea:focus {
            outline: none;
            background: rgba(6, 78, 59, 0.3);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
        }

        /* List items */
        .list-item {
            padding: 10px 15px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(34, 197, 94, 0.2);
            cursor: pointer;
            transition: all 0.15s;
        }

        .list-item:hover {
            background: rgba(34, 197, 94, 0.1);
        }

        .list-item.selected {
            background: rgba(34, 197, 94, 0.3);
            border-left: 4px solid #22c55e;
        }

        /* Buttons */
        .btn {
            background: rgba(0,0,0,0.6);
            border: 2px solid #22c55e;
            color: #22c55e;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.2s;
            margin: 5px;
        }

        .btn:hover {
            background: #22c55e;
            color: #000;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
        }

        /* Form elements */
        .form-input,
        .form-textarea {
            width: 100%;
            background: rgba(0,0,0,0.6);
            border: 2px solid #166534;
            color: #22c55e;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #22c55e;
            background: rgba(6, 78, 59, 0.3);
        }

        /* Status bar */
        .status {
            padding: 10px 15px;
            background: rgba(0,0,0,0.6);
            border-top: 2px solid #22c55e;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            letter-spacing: 1px;
        }

        /* Calendar */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #166534;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: rgba(0,0,0,0.4);
            transition: all 0.2s;
        }

        .calendar-day:hover {
            background: rgba(34, 197, 94, 0.1);
        }

        .calendar-day.today {
            background: #22c55e;
            color: #000;
            font-weight: bold;
        }

        /* Bank account display */
        .bank-display {
            background: rgba(0,0,0,0.5);
            padding: 30px;
            border: 2px solid #22c55e;
            text-align: center;
        }

        .bank-balance {
            font-size: 48px;
            font-weight: bold;
            color: #00ff41;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
        }

        .bank-label {
            font-size: 18px;
            color: #16a34a;
            margin-bottom: 10px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.4);
        }

        ::-webkit-scrollbar-thumb {
            background: #22c55e;
            border: 2px solid #000;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #16a34a;
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(6, 78, 59, 0.95);
            border: 3px solid #22c55e;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 60px rgba(34, 197, 94, 0.5);
        }

        .modal-close {
            float: right;
            background: none;
            border: none;
            color: #22c55e;
            font-size: 28px;
            cursor: pointer;
            font-weight: bold;
            line-height: 1;
        }

        .modal-close:hover {
            color: #00ff41;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="crt-overlay"></div>
        
        <div class="terminal">
            <div class="scanline"></div>

            <!-- Header -->
            <div class="header">
                <div class="header-top">
                    <div class="title">PIP-BOY 3000 Mk.IV</div>
                    <div class="datetime" id="datetime">2026.02.19 16:00:00</div>
                </div>
                
                <!-- Main Navigation -->
                <div class="nav-container">
                    <div class="main-tabs">
                        <button class="tab-btn active" data-main="jnl">JNL</button>
                        <button class="tab-btn" data-main="data">DATA</button>
                        <button class="tab-btn" data-main="smdy">SMDY</button>
                        <button class="tab-btn" data-main="sch">SCH</button>
                        <button class="tab-btn" data-main="inv">INV</button>
                    </div>
                </div>

                <!-- Sub Navigation (dynamic based on main tab) -->
                <div class="sub-tabs" id="subTabs">
                    <button class="sub-tab active" data-sub="main">MAIN</button>
                    <button class="sub-tab" data-sub="memo">MEMO</button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content" id="contentArea">
                <!-- Content will be dynamically loaded here -->
                <div class="quest-list">
                    <div class="quest-item">
                        <div class="quest-title">今日の記録</div>
                        <div class="quest-objective">朝食を食べた</div>
                        <div class="quest-objective incomplete">ジムに行く</div>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status">
                <div>STATUS: ACTIVE</div>
                <div id="statusInfo">ENTRIES: 0 | SYNC: READY</div>
            </div>
        </div>
    </div>

    <!-- Modal for detailed view -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeModal()">×</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        const app = {
            currentMain: 'jnl',
            currentSub: 'main',
            
            // Navigation structure
            navStructure: {
                jnl: {
                    name: 'JNL',
                    subs: {
                        main: 'MAIN',
                        memo: 'MEMO'
                    }
                },
                data: {
                    name: 'DATA',
                    subs: {
                        quests: 'QUESTS'
                    }
                },
                smdy: {
                    name: 'SMDY',
                    subs: {
                        place: 'PLACE'
                    }
                },
                sch: {
                    name: 'SCH',
                    subs: {
                        calendar: 'CALENDAR'
                    }
                },
                inv: {
                    name: 'INV',
                    subs: {
                        bank: 'BANK ACNT',
                        budget: 'BUDGET'
                    }
                }
            },

            // Data storage
            entries: [],
            memo: '',
            quests: [],
            places: [],
            schedules: [],
            bankBalance: 0,
            budgetEntries: [],

            audioContext: null,

            init() {
                this.setupEventListeners();
                this.updateDateTime();
                setInterval(() => this.updateDateTime(), 1000);
                this.loadData();
                this.render();
                
                // Audio initialization
                const initAudio = () => {
                    if (!this.audioContext) {
                        try {
                            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        } catch (e) {
                            console.warn('AudioContext failed:', e);
                        }
                    }
                    if (this.audioContext && this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }
                };
                document.addEventListener('click', initAudio, { once: true });
                document.addEventListener('keydown', initAudio, { once: true });
                document.addEventListener('touchstart', initAudio, { once: true });
            },

            setupEventListeners() {
                // Main tabs
                document.querySelectorAll('[data-main]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchMainTab(e.target.dataset.main);
                    });
                });

                // Sub tabs will be dynamically added
                this.updateSubTabs();
            },

            switchMainTab(mainTab) {
                this.currentMain = mainTab;
                this.currentSub = Object.keys(this.navStructure[mainTab].subs)[0];
                
                // Update active states
                document.querySelectorAll('[data-main]').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.main === mainTab);
                });
                
                this.updateSubTabs();
                this.render();
                this.playPipSound();
            },

            updateSubTabs() {
                const subTabsContainer = document.getElementById('subTabs');
                const subs = this.navStructure[this.currentMain].subs;
                
                subTabsContainer.innerHTML = '';
                Object.entries(subs).forEach(([key, label]) => {
                    const btn = document.createElement('button');
                    btn.className = 'sub-tab' + (key === this.currentSub ? ' active' : '');
                    btn.dataset.sub = key;
                    btn.textContent = label;
                    btn.addEventListener('click', () => this.switchSubTab(key));
                    subTabsContainer.appendChild(btn);
                });
            },

            switchSubTab(subTab) {
                this.currentSub = subTab;
                document.querySelectorAll('[data-sub]').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.sub === subTab);
                });
                this.render();
                this.playPipSound();
            },

            render() {
                const contentArea = document.getElementById('contentArea');
                const key = `${this.currentMain}_${this.currentSub}`;
                
                // Render based on current tab
                switch(key) {
                    case 'jnl_main':
                        this.renderJournalMain(contentArea);
                        break;
                    case 'jnl_memo':
                        this.renderMemo(contentArea);
                        break;
                    case 'data_quests':
                        this.renderQuests(contentArea);
                        break;
                    case 'smdy_place':
                        this.renderPlaces(contentArea);
                        break;
                    case 'sch_calendar':
                        this.renderCalendar(contentArea);
                        break;
                    case 'inv_bank':
                        this.renderBankAccount(contentArea);
                        break;
                    case 'inv_budget':
                        this.renderBudget(contentArea);
                        break;
                    default:
                        contentArea.innerHTML = '<p>Coming soon...</p>';
                }
            },

            renderJournalMain(container) {
                container.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <button class="btn" onclick="app.newEntry()">+ NEW ENTRY</button>
                    </div>
                    <div class="quest-list" id="entryList"></div>
                `;
                
                const list = document.getElementById('entryList');
                this.entries.forEach(entry => {
                    const date = new Date(entry.timestamp);
                    const dateStr = `${date.getFullYear()}.${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')}`;
                    
                    const item = document.createElement('div');
                    item.className = 'quest-item';
                    item.innerHTML = `
                        <div class="quest-title">${entry.text.substring(0, 50)}${entry.text.length > 50 ? '...' : ''}</div>
                        <div class="quest-objective">${dateStr}</div>
                    `;
                    item.onclick = () => this.viewEntry(entry);
                    list.appendChild(item);
                });
            },

            renderMemo(container) {
                container.innerHTML = `
                    <div class="memo-container">
                        <textarea class="memo-textarea" id="memoText" placeholder="Talk to Old Longfellow...">${this.memo}</textarea>
                        <button class="btn" onclick="app.saveMemo()">SAVE MEMO</button>
                    </div>
                `;
            },

            renderQuests(container) {
                container.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <button class="btn" onclick="app.newQuest()">+ NEW QUEST</button>
                    </div>
                    <div class="quest-list" id="questList"></div>
                `;
                
                const list = document.getElementById('questList');
                this.quests.forEach(quest => {
                    const item = document.createElement('div');
                    item.className = 'quest-item' + (quest.completed ? ' completed' : '');
                    item.innerHTML = `
                        <div class="quest-title">${quest.title}</div>
                        ${quest.objectives.map(obj => 
                            `<div class="quest-objective${obj.completed ? '' : ' incomplete'}">${obj.text}</div>`
                        ).join('')}
                    `;
                    list.appendChild(item);
                });
            },

            renderPlaces(container) {
                container.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <button class="btn" onclick="app.newPlace()">+ ADD PLACE</button>
                    </div>
                    <div class="quest-list" id="placeList"></div>
                `;
                
                const list = document.getElementById('placeList');
                this.places.forEach(place => {
                    const item = document.createElement('div');
                    item.className = 'quest-item';
                    item.innerHTML = `<div class="quest-title">${place.name}</div>`;
                    list.appendChild(item);
                });
            },

            renderCalendar(container) {
                container.innerHTML = '<div class="calendar-grid"></div>';
                // Calendar implementation here
            },

            renderBankAccount(container) {
                container.innerHTML = `
                    <div class="bank-display">
                        <div class="bank-label">CURRENT BALANCE</div>
                        <div class="bank-balance">¥${this.bankBalance.toLocaleString()}</div>
                        <button class="btn" onclick="app.updateBankBalance()">UPDATE BALANCE</button>
                    </div>
                `;
            },

            renderBudget(container) {
                container.innerHTML = '<div>Budget view coming soon...</div>';
                // Budget implementation
            },

            playPipSound() {
                if (!this.audioContext) {
                    try {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    } catch (e) {
                        return;
                    }
                }

                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);

                    oscillator.frequency.value = 280;
                    oscillator.type = 'square';

                    const now = this.audioContext.currentTime;
                    gainNode.gain.setValueAtTime(0.08, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);

                    oscillator.start(now);
                    oscillator.stop(now + 0.05);
                } catch (e) {
                    console.warn('Pip sound failed:', e);
                }
            },

            updateDateTime() {
                const now = new Date();
                const str = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
                document.getElementById('datetime').textContent = str;
            },

            loadData() {
                this.entries = JSON.parse(localStorage.getItem('entries') || '[]');
                this.memo = localStorage.getItem('memo') || '';
                this.quests = JSON.parse(localStorage.getItem('quests') || '[]');
                this.places = JSON.parse(localStorage.getItem('places') || '[]');
                this.schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
                this.bankBalance = parseFloat(localStorage.getItem('bankBalance') || '0');
                this.budgetEntries = JSON.parse(localStorage.getItem('budgetEntries') || '[]');
            },

            saveData() {
                localStorage.setItem('entries', JSON.stringify(this.entries));
                localStorage.setItem('memo', this.memo);
                localStorage.setItem('quests', JSON.stringify(this.quests));
                localStorage.setItem('places', JSON.stringify(this.places));
                localStorage.setItem('schedules', JSON.stringify(this.schedules));
                localStorage.setItem('bankBalance', this.bankBalance.toString());
                localStorage.setItem('budgetEntries', JSON.stringify(this.budgetEntries));
            },

            saveMemo() {
                this.memo = document.getElementById('memoText').value;
                this.saveData();
                alert('Memo saved!');
            },

            updateBankBalance() {
                const newBalance = prompt('Enter new balance:', this.bankBalance);
                if (newBalance !== null) {
                    this.bankBalance = parseFloat(newBalance) || 0;
                    this.saveData();
                    this.render();
                }
            },

            newEntry() {
                const text = prompt('New journal entry:');
                if (text) {
                    this.entries.unshift({
                        id: Date.now().toString(),
                        text: text,
                        timestamp: Date.now()
                    });
                    this.saveData();
                    this.render();
                }
            },

            viewEntry(entry) {
                const date = new Date(entry.timestamp);
                const dateStr = `${date.getFullYear()}.${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')} ${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
                
                document.getElementById('modalContent').innerHTML = `
                    <h3>${dateStr}</h3>
                    <p style="margin-top: 20px; line-height: 1.8;">${entry.text}</p>
                `;
                document.getElementById('modal').classList.add('active');
            },

            newQuest() {
                const title = prompt('Quest title:');
                if (title) {
                    this.quests.push({
                        id: Date.now().toString(),
                        title: title,
                        objectives: [],
                        completed: false
                    });
                    this.saveData();
                    this.render();
                }
            },

            newPlace() {
                const name = prompt('Place name:');
                if (name) {
                    this.places.push({
                        id: Date.now().toString(),
                        name: name
                    });
                    this.saveData();
                    this.render();
                }
            },

            closeModal() {
                document.getElementById('modal').classList.remove('active');
            }
        };

        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
